## Instalaci贸n de Suricata
Instalaci贸n en Linux (Ubuntu)
1. Actualizar repositorios:
```
sudo apt update && sudo apt upgrade -y
```
2. A帽adir repositorio de Suricata:
```
sudo add-apt-repository ppa:oisf/suricata-stable -y
sudo apt update
```
3. Instalar Suricata:
```
sudo apt install suricata -y
```
4. Verificar instalaci贸n:
```
suricata --build-info
```

5. Habilitar y arrancar el servicio:
```
sudo systemctl enable --now suricata
```

## Configuraci贸n de Suricata
*  Las reglas son el n煤cleo de Suricata, definiendo qu茅 tr谩fico vigilar o bloquear.
*  Puedes crear y gestionar tus propias reglas en local.rules.
*  Con suricata-update puedes mantener actualizadas las reglas comunitarias.
* З La gesti贸n eficiente en suricata.yaml es clave para un IDS/IPS organizado.

Suricata usa archivos de reglas (`.rules`) para definir el comportamiento del IDS/IPS.

Principales ubicaciones:
* Directorio principal: `/etc/suricata/`
* Configuraci贸n principal: `/etc/suricata/suricata.yaml`
* Reglas oficiales: `/etc/suricata/rules/`

| Archivo         | Descripci贸n                                    |
|-----------------|------------------------------------------------|
| `suricata.rules`| Archivo combinado con todas las reglas activas.|
| `local.rules`   | Archivo recomendado para reglas personalizadas.|

### Configuraci贸n con suricata.yaml
Localiza las siguientes secciones en el archivo `/etc/suricata/suricata.yaml`
```yaml
# Configuraci贸n de la interfaz de red
af-packet:
  - interface: eth0

# Configuraci贸n de logs
outputs:
  - eve-log:
      enabled: yes
      filetype: json
      filename: /var/log/suricata/eve.json

# Archivos de reglas
default-rule-path: /etc/suricata/rules
rule-files:
  - suricata.rules
  - local.rules

```
Para aplicar cambios ejecuta: `sudo systemctl restart suricata`
<br>
O si prefieres probar directamente sin tocar el servicio, puedes lanzar Suricata en modo prueba:
```
sudo suricata -c /etc/suricata/suricata.yaml -i eth0
```

---

### Configuraci贸n de las reglas
Dentro del archivo `suricata.yaml`, indicamos los archivos `.rules` que Suricata cargar谩:
```yaml
rule-files:
  - suricata.rules
  - local.rules
  - emerging-threats.rules
```

### Orden de los archivos de reglas
Cuando Suricata carga las reglas, las procesa en el orden en que aparecen en la lista. Esto afecta principalmente a dos aspectos importantes:
   1. Orden de evaluaci贸n de reglas: Suricata analiza los paquetes siguiendo el orden de los archivos.
   2. Sobrescritura de reglas: si tienes reglas duplicadas (la misma firma o ID de regla) en diferentes archivos, la 煤ltima regla cargada sobrescribir谩 las anteriores.

 Estrategia recomendada:
   * Reglas oficiales o predefinidas primero: como las de Emerging Threats o las reglas base de Suricata.
   * Reglas personalizadas al final: para que puedas ajustar o sobrescribir reglas sin modificar los archivos originales (esto evita problemas al actualizar).

Un ejemplo de orden 贸tpimo ser铆a:
```yaml
rule-files:
  - emerging-threats.rules      # Reglas comunitarias actualizadas
  - suricata.rules              # Reglas base o est谩ndar
  - local.rules                 # Reglas personalizadas o ajustes locales
```

---

### Agregar una regla personalizada
Para agregar una regla personalizada debemos editar el archivo de reglas `local.rules`.

Editar el archivo de reglas:
```
sudo nano /etc/suricata/rules/local.rules
```
Agrega la siguiente regla:
```
alert tcp any any -> any 80 (msg:"Tr谩fico HTTP detectado"; sid:100002; rev:1;)
```
Para aplicar la nueva regla tenemos 2 opciones:
```
sudo systemctl restart suricata   // Reinicia completamente Suricata (detiene y vuelve a iniciar).
pkill -HUP suricata               // Recarga reglas y configuraci贸n sin interrumpir la captura de tr谩fico.
```
